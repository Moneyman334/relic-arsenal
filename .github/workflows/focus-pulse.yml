name: Mindset Pulse - Daily Focus Ritual

on:
  schedule:
    # Run daily at 9 AM UTC (adjust timezone as needed)
    - cron: '0 9 * * 1-5'  # Monday to Friday
  workflow_dispatch:
    inputs:
      message_type:
        description: 'Type of focus message'
        required: false
        default: 'daily'
        type: choice
        options:
          - daily
          - weekly
          - retrospective

env:
  # Configure these in repository secrets for actual notifications
  SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
  DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}

jobs:
  focus-pulse:
    name: ğŸ§˜ Daily Focus Pulse
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    
    steps:
      - name: Generate Focus Message
        id: message
        run: |
          MESSAGE_TYPE="${{ github.event.inputs.message_type || 'daily' }}"
          WEEK_DAY=$(date +%A)
          DATE=$(date +"%B %d, %Y")
          
          case "$MESSAGE_TYPE" in
            "daily")
              TITLE="ğŸŒ… Daily Focus Ritual - $WEEK_DAY, $DATE"
              MESSAGE="**âš¡ Crown the Vault - Daily Storm âš¡**

          ğŸ”® **Today's Cosmic Question:**
          What single relic will you forge today to advance the vault?

          ğŸŒ€ **Focus Areas:**
          â€¢ ğŸ”‘ **One Key Task** - What's the most important thing to complete?
          â€¢ âš¡ **Storm Progress** - Which project needs your lightning today?
          â€¢ ğŸ“œ **Knowledge Scroll** - What will you learn or document?

          ğŸ’ **Mindful Mantras:**
          > \"You always got to keep dripping so wet!\" â€” ChaosKey333
          > \"Through quantum tempests, we forge eternity.\"

          ğŸ¯ **Today's Quest:** Set one clear, achievable goal and let the cosmic forces guide your focus.

          ---
          *Reply with your daily intention to manifest cosmic accountability!*"
              ;;
            "weekly")
              TITLE="ğŸ‘‘ Weekly Storm Planning - Week of $DATE"
              MESSAGE="**ğŸŒ€ Weekly Storm Convergence ğŸŒ€**

          ğŸ”® **Weekly Reflection Ritual:**
          Time to align the cosmic forces for maximum vault expansion!

          âš¡ **Storm Assessment:**
          â€¢ ğŸ“Š **Last Week's Victories** - What relics were successfully forged?
          â€¢ ğŸ” **Challenges Faced** - What obstacles emerged from the quantum mist?
          â€¢ ğŸ¯ **This Week's Focus** - Which storms deserve your lightning?

          ğŸŒŸ **Power Zones:**
          â€¢ ğŸ”§ **Technical Mastery** - Skills to develop or practice
          â€¢ ğŸ¤ **Collaboration Nexus** - Connections to strengthen
          â€¢ ğŸ“œ **Knowledge Scrolls** - Documentation to create or improve

          ğŸ‘‘ **Crown the Week:**
          Set 3 major goals that will significantly advance the vault's cosmic power!

          ---
          *Share your weekly intentions and let the community amplify your focus!*"
              ;;
            "retrospective")
              TITLE="ğŸ”® Retrospective Wisdom - End of Cycle Reflection"
              MESSAGE="**ğŸŒŒ Cosmic Retrospective Portal ğŸŒŒ**

          âš¡ **Deep Reflection Ritual** âš¡

          ğŸ” **Storm Analysis:**
          â€¢ ğŸ‰ **Cosmic Wins** - What made you proud this cycle?
          â€¢ ğŸ“š **Lessons Learned** - What wisdom emerged from challenges?
          â€¢ ğŸ”„ **Process Evolution** - What workflows can be improved?

          ğŸŒŸ **Power Level Assessment:**
          â€¢ ğŸ’ª **Strengths Manifested** - Where did you excel?
          â€¢ ğŸŒ± **Growth Opportunities** - Where can you level up?
          â€¢ ğŸ”® **Future Vision** - What excites you for the next cycle?

          ğŸ¯ **Gratitude Storm:**
          Acknowledge the cosmic forces, collaborators, and personal growth that made this cycle possible.

          ---
          *Share your retrospective insights to inspire the vault community!*"
              ;;
          esac
          
          # Store values for use in subsequent steps
          echo "title=$TITLE" >> $GITHUB_OUTPUT
          echo "message<<EOF" >> $GITHUB_OUTPUT
          echo "$MESSAGE" >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT

      - name: Send Slack Notification
        if: env.SLACK_WEBHOOK_URL != ''
        run: |
          curl -X POST -H 'Content-type: application/json' \
            --data "{
              \"text\": \"${{ steps.message.outputs.title }}\",
              \"blocks\": [
                {
                  \"type\": \"section\",
                  \"text\": {
                    \"type\": \"mrkdwn\",
                    \"text\": \"${{ steps.message.outputs.message }}\"
                  }
                },
                {
                  \"type\": \"context\",
                  \"elements\": [
                    {
                      \"type\": \"mrkdwn\",
                      \"text\": \"ğŸ¦â€â¬› <https://github.com/${{ github.repository }}|ChaosKey333 Relic Arsenal> ğŸ¦â€â¬›\"
                    }
                  ]
                }
              ]
            }" \
            ${{ env.SLACK_WEBHOOK_URL }}

      - name: Send Discord Notification
        if: env.DISCORD_WEBHOOK_URL != ''
        run: |
          curl -X POST -H 'Content-Type: application/json' \
            --data "{
              \"embeds\": [
                {
                  \"title\": \"${{ steps.message.outputs.title }}\",
                  \"description\": \"${{ steps.message.outputs.message }}\",
                  \"color\": 7506394,
                  \"footer\": {
                    \"text\": \"ğŸ¦â€â¬› ChaosKey333 Relic Arsenal ğŸ¦â€â¬›\"
                  },
                  \"timestamp\": \"$(date -u +%Y-%m-%dT%H:%M:%S.000Z)\"
                }
              ]
            }" \
            ${{ env.DISCORD_WEBHOOK_URL }}

      - name: Create Discussion (Alternative)
        if: env.SLACK_WEBHOOK_URL == '' && env.DISCORD_WEBHOOK_URL == ''
        uses: actions/github-script@v7
        with:
          script: |
            // Create a GitHub Discussion as alternative to external notifications
            const title = '${{ steps.message.outputs.title }}';
            const body = `${{ steps.message.outputs.message }}

            ---
            ğŸ”§ **Setup Note:** Configure \`SLACK_WEBHOOK_URL\` or \`DISCORD_WEBHOOK_URL\` repository secrets to enable external notifications.
            
            For now, use this discussion to share your daily/weekly focus and connect with the vault community!`;
            
            console.log('Focus Pulse message generated:');
            console.log('Title:', title);
            console.log('Message:', body);
            
            // Note: Creating discussions requires additional permissions
            // This serves as a fallback logging mechanism
            core.summary.addHeading('ğŸ§˜ Focus Pulse Generated');
            core.summary.addRaw(body);
            core.summary.write();

  weekly-metrics:
    name: ğŸ“Š Weekly Metrics Pulse
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main' && github.event.schedule == '0 9 * * 1'  # Only on Mondays
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Generate Weekly Metrics
        run: |
          echo "ğŸ“Š Generating weekly vault metrics..."
          
          # Calculate basic metrics
          COMMITS_THIS_WEEK=$(git log --since="1 week ago" --oneline | wc -l)
          CONTRIBUTORS_THIS_WEEK=$(git log --since="1 week ago" --format='%ae' | sort | uniq | wc -l)
          FILES_CHANGED=$(git diff --name-only HEAD~7 HEAD | wc -l)
          
          # Test metrics (if tests exist)
          if npm test > /dev/null 2>&1; then
            TEST_STATUS="âœ… Passing"
          else
            TEST_STATUS="âš ï¸ Needs attention"
          fi
          
          # Generate metrics summary
          cat << EOF > weekly-metrics.md
          ## ğŸ“Š Weekly Vault Metrics
          
          **âš¡ Activity Storm:**
          - ğŸ”„ Commits: $COMMITS_THIS_WEEK
          - ğŸ‘¥ Contributors: $CONTRIBUTORS_THIS_WEEK  
          - ğŸ“ Files Modified: $FILES_CHANGED
          - ğŸ§ª Test Status: $TEST_STATUS
          
          **ğŸ”® Cosmic Insights:**
          $(if [ $COMMITS_THIS_WEEK -gt 10 ]; then echo "High storm activity - excellent momentum! âš¡"; else echo "Steady cosmic flow - consistent progress ğŸŒ€"; fi)
          
          **ğŸ‘‘ Focus Opportunities:**
          - Review recent changes for optimization potential
          - Consider documentation updates for modified areas
          - Plan next week's storm priorities
          
          ---
          *Metrics generated by the Mindset Pulse ritual*
          EOF
          
          echo "Weekly metrics generated:"
          cat weekly-metrics.md

      - name: Upload Metrics
        uses: actions/upload-artifact@v4
        with:
          name: weekly-metrics
          path: weekly-metrics.md